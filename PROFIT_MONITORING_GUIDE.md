# Alpha-Orion Profit Monitoring Guide

## Overview

This guide explains how to verify and monitor real profits generated by the Alpha-Orion flash loan arbitrage system.

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Alpha-Orion System                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐  │
│  │  FlashLoan   │    │  Brain       │    │  Monitoring   │  │
│  │  Arbitrage   │───▶│  Orchestrator│───▶│  Dashboard    │  │
│  │  Contract    │    │  (API)       │    │  (Real-time) │  │
│  └──────────────┘    └──────────────┘    └──────────────┘  │
│         │                   │                    │          │
│         │  Events           │  Metrics           │          │
│         ▼                   ▼                    ▼          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                    Redis Cache                         │   │
│  │  - total_pnl    - total_trades    - win_rate        │   │
│  │  - trade_history - profit_metrics                    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## API Endpoints for Profit Monitoring

### 1. Real-Time Profit Metrics

```bash
curl http://localhost:8080/profit/real-time
```

**Response:**
```json
{
  "mode": "live",
  "totalPnl": 1234.56,
  "totalTrades": 45,
  "winRate": 85.5,
  "avgProfitPerTrade": 27.43,
  "profitPerHour": 3.60,
  "profitPerDay": 86.40,
  "status": "active",
  "contractAddress": "0x...",
  "timestamp": "2024-02-10T03:00:00Z"
}
```

### 2. Daily Profit Breakdown

```bash
curl http://localhost:8080/profit/daily?days=7
```

**Response:**
```json
{
  "period": "last_7_days",
  "totalProfit": 604.80,
  "dailyBreakdown": [
    {"date": "2024-02-09", "profit": 86.40, "trades": 12},
    {"date": "2024-02-08", "profit": 82.30, "trades": 11},
    {"date": "2024-02-07", "profit": 91.20, "trades": 13}
  ]
}
```

### 3. Profit by Token

```bash
curl http://localhost:8080/profit/by-token
```

**Response:**
```json
{
  "WETH": {
    "address": "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
    "profit": 450.50,
    "trades": 15
  },
  "USDC": {
    "address": "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
    "profit": 289.30,
    "trades": 12
  }
}
```

### 4. Blockchain Status

```bash
curl http://localhost:8080/blockchain/status
```

**Response:**
```json
{
  "connected": true,
  "network": "ethereum",
  "chain_id": 1,
  "latest_block": 18500000,
  "gas_price_gwei": 25.5,
  "contract_deployed": true,
  "contract_address": "0x...",
  "pimlico_enabled": true,
  "gasless_mode": true,
  "timestamp": "2024-02-10T03:00:00Z"
}
```

## Smart Contract Events

The FlashLoanArbitrage contract emits events for tracking:

### ArbitrageExecuted Event
```solidity
event ArbitrageExecuted(
    address indexed tokenIn,
    address indexed tokenOut,
    uint256 profit,
    uint256 gasUsed
);
```

### FundsRecovered Event
```solidity
event FundsRecovered(
    address indexed token,
    uint256 amount
);
```

## Verification Steps

### 1. Verify Contract Deployment

```bash
# Check contract on Etherscan
echo "Contract: $(cat deployments/mainnet.json | grep contractAddress)"

# Verify contract source
npx hardhat verify --network mainnet <CONTRACT_ADDRESS>
```

### 2. Check Contract Balance

```bash
# Get current contract balances
curl http://localhost:8080/wallet
```

### 3. Monitor Events

```bash
# Watch for new arbitrage events
curl http://localhost:8080/blockchain/events
```

## Running the Dashboard

### Local Development

```bash
# Start the backend
cd backend-services/services/brain-orchestrator/src
pip install -r requirements.txt
python main.py &

# Open dashboard in browser
open ../../../../LIVE_PROFIT_DASHBOARD.html
```

### Production (Docker)

```bash
# Build and run
cd alpha-orion
docker build -t alpha-orion-backend ./backend-services/services/brain-orchestrator/
docker run -p 8080:8080 alpha-orion-backend
```

## Key Metrics Explained

| Metric | Description | Calculation |
|--------|-------------|-------------|
| Total PnL | Total profit/loss in USD | Sum of all trade profits |
| Win Rate | Percentage of profitable trades | (Winning Trades / Total Trades) × 100 |
| Avg Profit/Trade | Mean profit per execution | Total PnL / Total Trades |
| Gas Spent | Total gas costs (if not gasless) | Sum of gas used × gas price |
| Net Profit | Profit after all costs | Total PnL - Gas Spent |

## Alert Thresholds

Configure alerts in `.env.production`:

```env
# Alert thresholds
ALERT_PROFIT_DROP=10%      # Alert if daily profit drops 10%
ALERT_WIN_RATE_MIN=70%      # Alert if win rate falls below 70%
ALERT_GAS_SPIKE=2x          # Alert if gas price spikes 2x normal
```

## Troubleshooting

### No Data Showing
1. Check if backend is running: `curl http://localhost:8080/health`
2. Verify Redis connection: `redis-cli ping`
3. Check contract is deployed: `cat deployments/mainnet.json`

### Zero Profits
1. Verify mode is "live": `curl http://localhost:8080/mode/status`
2. Check contract events: `curl http://localhost:8080/blockchain/events`
3. Review gas prices: `curl http://localhost:8080/blockchain/status`

### Connection Issues
1. Verify RPC URL in `.env`
2. Check Pimlico API key
3. Confirm contract address is set
