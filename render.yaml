# Alpha-Orion Complete Render Deployment Configuration
# Version: 2.1 - February 2026
# NOTE: This file uses Render's native buildpacks (Node.js/Python)
# The root Dockerfile exists for reference but native builds work better

services:
  # ============================================================
  # USER API SERVICE (Node.js)
  # ============================================================
  - type: web
    name: alpha-orion-api
    env: node
    nodeVersion: 18
    buildCommand: cd backend-services/services/user-api-service && npm install
    startCommand: cd backend-services/services/user-api-service && npm start
    envVars:
      - key: PORT
        value: 8080
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: alpha-orion-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: alpha-orion-redis
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: ETHEREUM_RPC_URL
        sync: false
    healthCheckPath: /health
    autoscaling:
      enabled: true
      minInstances: 1
      maxInstances: 10
    domains:
      - alpha-orion-api.onrender.com

  # ============================================================
  # DASHBOARD (React Frontend)
  # ============================================================
  - type: web
    name: alpha-orion-dashboard
    env: node
    nodeVersion: 18
    buildCommand: cd dashboard && npm install && npm run build
    startCommand: npx serve -s dist -l $PORT
    envVars:
      - key: NODE_VERSION
        value: "18"
      - key: VITE_API_URL
        fromService:
          type: web
          name: alpha-orion-api
          property: url
      - key: VITE_WS_URL
        fromService:
          type: web
          name: alpha-orion-api
          property: url
    healthCheckPath: /
    autoscaling:
      enabled: true
      minInstances: 1
      maxInstances: 3
    domains:
      - alpha-orion-dashboard.onrender.com

# ============================================================
# DATABASES
# ============================================================

databases:
  - name: alpha-orion-db
    databaseName: alphaorion
    user: alpha_user
    plan: starter
    postgresVersion: "15"

# ============================================================
# REDIS
# ============================================================

redis:
  - name: alpha-orion-redis
    ipAllowList: []
    plan: starter

# ============================================================
# ENVIRONMENT GROUPS
# ============================================================

envVarGroups:
  - name: alpha-orion-config
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: LOG_LEVEL
        value: INFO

  - name: alpha-orion-secrets
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: ETHEREUM_RPC_URL
        sync: false
      - key: JWT_SECRET
        sync: false
