# Alpha-Orion Complete Render Deployment Configuration
# Version: 3.0 - DASHBOARD AS PRIMARY SERVICE
# The main URL will serve the dashboard frontend

services:
  # ============================================================
  # DASHBOARD (React Frontend) - PRIMARY SERVICE
  # This serves at the main URL: alpha-orion.onrender.com
  # ============================================================
  # ============================================================
  # DASHBOARD (React Frontend) - PRIMARY SERVICE
  # This serves at the main URL: alpha-orion.onrender.com
  # ============================================================
  - type: web
    name: alpha-orion
    root: dashboard
    env: node
    nodeVersion: 18
    buildCommand: npm install && npm run build
    startCommand: npx serve -s dist -l $PORT
    envVars:
      - key: NODE_VERSION
        value: "18"
      - key: NODE_ENV
        value: production
      - key: VITE_API_URL
        value: https://alpha-orion-api.onrender.com
      - key: VITE_WS_URL
        sync: false
    healthCheckPath: /
    autoscaling:
      enabled: true
      minInstances: 1
      maxInstances: 3

  # ============================================================
  # BACKEND API SERVICE
  # Required for profit generation and AI features
  # ============================================================
  - type: web
    name: alpha-orion-api
    root: backend-services/services/user-api-service
    env: node
    nodeVersion: 18
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: PORT
        value: 8080
      - key: DATABASE_URL
        fromDatabase:
          name: alpha-orion-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: alpha-orion-redis
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: INFURA_API_KEY
        sync: false
      - key: POLYGON_RPC_URL
        value: https://polygon-rpc.com
      - key: PRIVATE_KEY
        sync: false
      - key: FLASH_LOAN_EXECUTOR_ADDRESS
        sync: false
      - key: AI_OPTIMIZER_URL
        value: http://alpha-orion-ai-optimizer:8080
      - key: NODE_ENV
        value: production
    healthCheckPath: /health

  # ============================================================
  # AI OPTIMIZER SERVICE
  # Powers ML-driven strategy filtering and optimization
  # ============================================================
  - type: web
    name: alpha-orion-ai-optimizer
    root: backend-services/services/ai-optimizer
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn -b 0.0.0.0:$PORT --chdir src main:app
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: alpha-orion-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: alpha-orion-redis
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: GEMINI_API_KEY
        sync: false

# ============================================================
# DATABASES
# ============================================================

databases:
  - name: alpha-orion-db
    databaseName: alphaorion
    user: alpha_user
    plan: starter

# ============================================================
# REDIS
# ============================================================

redis:
  - name: alpha-orion-redis
    ipAllowList: []
    plan: starter

# ============================================================
# ENVIRONMENT GROUPS
# ============================================================

envVarGroups:
  - name: alpha-orion-config
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: LOG_LEVEL
        value: INFO

  - name: alpha-orion-secrets
    envVars:
      - key: VITE_API_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
