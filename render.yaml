# Alpha-Orion Unified Render Deployment
# Version: 5.1 - PRODUCTION READY
#
# One Node.js service handles BOTH the React dashboard AND the backend API.
# Endpoint: https://alpha-orion-alpha.onrender.com
#
# Architecture:
#   - Build step: Compiles the React dashboard, then installs API dependencies
#   - Runtime:    Node.js backend serves /api/* routes + static dashboard files
#   - No separate API service needed → zero CORS/URL discovery issues

services:
  # ============================================================
  # UNIFIED SERVICE: Dashboard + API in one process
  # Matches the existing service name on Render: alpha-orion-alpha
  # ============================================================
  - type: web
    name: alpha-orion-alpha
    env: node
    nodeVersion: 18
    # Build step: compile React frontend, then install Node.js backend deps
    buildCommand: cd dashboard && npm install && npm run build && cd .. && cd backend-services/services/user-api-service && npm install
    # Start: run Node.js backend — it serves /api/* AND the built React app
    startCommand: node backend-services/services/user-api-service/src/index.js
    envVars:
      - key: NODE_ENV
        value: production
      # VITE_API_URL must match THIS service URL so /api calls resolve correctly
      - key: VITE_API_URL
        value: https://alpha-orion-alpha.onrender.com
      
      # Blockchain RPC URLs (Public - No API key needed)
      - key: POLYGON_RPC_URL
        value: https://polygon-rpc.com
      - key: ETHEREUM_RPC_URL
        value: https://eth.llamarpc.com
      - key: ARBITRUM_RPC_URL
        value: https://arb1.arbitrum.io/rpc
      - key: OPTIMISM_RPC_URL
        value: https://mainnet.optimism.io
      - key: BASE_RPC_URL
        value: https://mainnet.base.org
      - key: BSC_RPC_URL
        value: https://bsc-dataseed.binance.org
      
      # Wallet Address for production mode display
      - key: WALLET_ADDRESS
        sync: false
      
      # Flash Loan Executor Contract Address (DEPLOY THIS CONTRACT TO ENABLE TRADING)
      # Deploy FlashLoan.sol to Polygon mainnet and paste address here
      - key: FLASH_LOAN_EXECUTOR_ADDRESS
        sync: false
      
      # Pimlico for gasless transactions (already in .env locally)
      # Add your PIMLICO_API_KEY in Render dashboard secrets
      - key: PIMLICO_API_KEY
        sync: false
      
      # OpenAI for AI features
      - key: OPENAI_API_KEY
        sync: false
      
    healthCheckPath: /health
