# Alpha-Orion Unified Render Deployment
# Version: 5.0 - SINGLE UNIFIED SERVICE
#
# One Node.js service handles BOTH the React dashboard AND the backend API.
# Endpoint: https://alpha-orion-alpha.onrender.com
#
# Architecture:
#   - Build step: Compiles the React dashboard, then installs API dependencies
#   - Runtime:    Node.js backend serves /api/* routes + static dashboard files
#   - No separate API service needed → zero CORS/URL discovery issues

services:
  # ============================================================
  # UNIFIED SERVICE: Dashboard + API in one process
  # Matches the existing service name on Render: alpha-orion-alpha
  # ============================================================
  - type: web
    name: alpha-orion-alpha
    env: node
    nodeVersion: 18
    # Build step: compile React frontend, then install Node.js backend deps
    buildCommand: cd dashboard && npm install && npm run build && cd .. && cd backend-services/services/user-api-service && npm install
    # Start: run Node.js backend — it serves /api/* AND the built React app
    startCommand: node backend-services/services/user-api-service/src/index.js
    envVars:
      - key: NODE_ENV
        value: production
      # VITE_API_URL must match THIS service URL so /api calls resolve correctly
      # Since API + frontend are on the same domain, relative URLs work.
      # Set explicitly to avoid auto-discovery picking the wrong host.
      - key: VITE_API_URL
        value: https://alpha-orion-alpha.onrender.com
      - key: POLYGON_RPC_URL
        value: https://polygon-rpc.com
      # Set these secrets in the Render dashboard (leave as sync: false)
      - key: OPENAI_API_KEY
        sync: false
      - key: PRIVATE_KEY
        sync: false
      - key: FLASH_LOAN_EXECUTOR_ADDRESS
        sync: false
      - key: PIMLICO_API_KEY
        sync: false
    healthCheckPath: /health
